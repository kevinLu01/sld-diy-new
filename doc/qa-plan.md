# QA 测试计划与用例框架（Week 1-2 交付）

对齐文档：`doc/plan.md`

目标：提供可执行的 UI 与 API 测试计划与用例框架，覆盖主流程与边界场景（MVP）。

---

## 1. 范围与优先级

### 1.1 覆盖范围（MVP）
- 前台（移动端）：方案包推荐、一键套用、DIY 微调、兼容校验、询价提交
- 后台（管理台）：方案包管理、SKU 组件库、规则引擎、价格策略、发布/下架
- API：`doc/plan.md` 第 8 节列出的 MVP 接口

### 1.2 不在本期范围
- 进度查询（可选二期）
- 报价版本、RBAC、审计日志、消息队列、ERP/CRM 对接

### 1.3 优先级
- P0：主流程可跑通（展示 → 套用 → 微调 → 校验 → 询价 → 后台可见）
- P1：异常/边界处理（兼容冲突、价格异常、表单校验、去重）
- P2：性能与并发（基础响应时间与并发稳定性）

---

## 2. 测试环境与数据

### 2.1 UI 测试环境
- 设备：Chrome 设备模拟 390–430px 宽度
- 浏览器：Chrome 最新版

### 2.2 API 测试环境
- 工具：Postman / curl
- 环境：本地或测试环境（建议提供独立测试数据）

### 2.3 基础测试数据（建议）
- 方案包：小型/中型/大型各 1 个，覆盖不同场景
- SKU：压缩机、冷风机、阀件、安装服务各 ≥2 个
- 规则：1 条冲突规则、1 条替代推荐规则
- 地区：华东/华南/华北 3 组地区系数

---

## 3. UI 测试计划（主流程与边界）

### 3.1 主流程（P0）
1. 进入首页 → 方案包推荐展示
2. 一键套用方案包 → 默认组件 + 默认价格
3. DIY 微调 → 替换组件/增减服务 → 价格联动
4. 兼容校验 → 正常通过或冲突提示 + 替代推荐
5. 询价提交 → 表单校验 → 成功回执
6. 后台：方案包发布后前台可见

### 3.2 UI 用例框架
字段规范：`ID`、`模块`、`场景`、`前置条件`、`步骤`、`预期结果`、`优先级`

### 3.3 UI 用例清单（示例）
| ID | 模块 | 场景 | 前置条件 | 步骤 | 预期结果 | 优先级 |
|---|---|---|---|---|---|---|
| UI-001 | 前台 | 方案包推荐展示 | 已发布方案包 | 打开首页 | 显示方案包卡片（名称/适用范围/核心组件/价格） | P0 |
| UI-002 | 前台 | 场景筛选 | 有多场景方案包 | 切换场景筛选 | 列表更新，仅显示匹配场景 | P1 |
| UI-003 | 前台 | 一键套用 | 方案包存在 | 点击“套用方案包” | 默认配置与默认价格加载 | P0 |
| UI-004 | 前台 | DIY 替换组件 | 组件可替代 | 替换组件 | 组件替换成功，价格更新 | P0 |
| UI-005 | 前台 | DIY 增加服务 | 可选服务存在 | 勾选安装服务 | 价格增加，明细更新 | P0 |
| UI-006 | 前台 | 兼容校验通过 | 兼容配置 | 点击校验/提交 | 无冲突提示 | P0 |
| UI-007 | 前台 | 兼容冲突提示 | 触发冲突规则 | 提交或校验 | 提示冲突原因 + 替代推荐 | P0 |
| UI-008 | 前台 | 价格异常 | 价格缺失/为 0 | 刷新/提交 | 明确提示，不允许提交 | P1 |
| UI-009 | 前台 | 表单校验 | 手机号为空 | 提交询价 | 提示错误，阻止提交 | P0 |
| UI-010 | 前台 | 表单校验 | 手机号格式错误 | 提交询价 | 提示错误，阻止提交 | P0 |
| UI-011 | 前台 | 询价去重 | 相同手机号/项目重复提交 | 再次提交 | 返回去重提示或合并结果 | P1 |
| UI-012 | 前台 | 询价成功回执 | 表单合法 | 提交询价 | 成功提示 + 询价编号 | P0 |
| UI-013 | 前台 | 异常网络 | 断网或 5xx | 提交询价 | 提示失败，可重试 | P1 |
| UI-014 | 后台 | 方案包新建 | 有后台权限 | 新建并保存 | 列表可见，字段正确 | P0 |
| UI-015 | 后台 | 方案包复制 | 已有方案包 | 复制 | 新版本生成，可编辑 | P1 |
| UI-016 | 后台 | 方案包发布 | 方案包可发布 | 发布 | 前台可见 | P0 |
| UI-017 | 后台 | 方案包下架 | 已发布 | 下架 | 前台不可见 | P0 |
| UI-018 | 后台 | SKU 维护 | 有权限 | 新增 SKU | 可在方案包选择 | P0 |
| UI-019 | 后台 | 规则配置 | 有权限 | 新增兼容规则 | 前台触发校验生效 | P1 |
| UI-020 | 后台 | 价格策略 | 有权限 | 设置地区系数 | 前台价格随地区变化 | P1 |

---

## 4. API 测试计划（主流程与边界）

### 4.1 主流程（P0）
1. 获取方案包列表 `GET /api/packages`
2. 获取方案包详情 `GET /api/packages/{id}`
3. 计算价格 `POST /api/pricing/calc`
4. 规则校验 `POST /api/rules/validate`
5. 提交询价 `POST /api/inquiries`
6. 后台方案包管理与发布 `GET/POST /api/admin/packages`

### 4.2 API 用例框架
字段规范：`ID`、`API`、`场景`、`请求`、`断言`、`优先级`

### 4.3 API 用例清单（示例）
| ID | API | 场景 | 请求 | 断言 | 优先级 |
|---|---|---|---|---|---|
| API-001 | GET /api/packages | 默认列表 | 无参数 | 返回发布中方案包列表 | P0 |
| API-002 | GET /api/packages | 场景筛选 | `?scene=冷库` | 返回匹配场景 | P1 |
| API-003 | GET /api/packages/{id} | 详情成功 | 有效 id | 返回组件清单+默认价格 | P0 |
| API-004 | GET /api/packages/{id} | 详情失败 | 无效 id | 404 或明确错误码 | P1 |
| API-005 | POST /api/pricing/calc | 正常计算 | 合法配置 | 返回价格明细与总价 | P0 |
| API-006 | POST /api/pricing/calc | 缺失必填 | 缺 SKU | 400 + 错误信息 | P0 |
| API-007 | POST /api/pricing/calc | 地区系数 | 不同地区 | 总价随地区变化 | P1 |
| API-008 | POST /api/rules/validate | 兼容通过 | 合规配置 | `valid=true` | P0 |
| API-009 | POST /api/rules/validate | 兼容冲突 | 冲突配置 | `valid=false` + 原因 + 推荐 | P0 |
| API-010 | POST /api/inquiries | 成功提交 | 合法表单 | 返回询价 id | P0 |
| API-011 | POST /api/inquiries | 表单校验 | 缺手机号 | 400 + 校验信息 | P0 |
| API-012 | POST /api/inquiries | 去重 | 重复提交 | 返回去重提示或同一 id | P1 |
| API-013 | GET /api/admin/packages | 鉴权 | 无 token | 401/403 | P0 |
| API-014 | POST /api/admin/packages | 创建 | 合法 body | 新增成功 | P0 |
| API-015 | POST /api/admin/packages | 更新 | 已存在 id | 修改成功 | P0 |
| API-016 | POST /api/admin/packages/{id}/publish | 发布 | 合法 id | 状态变为已发布 | P0 |
| API-017 | POST /api/admin/packages/{id}/publish | 发布失败 | 规则冲突 | 返回冲突原因 | P1 |
| API-018 | 全局 | 并发稳定 | 高并发请求 | 无 5xx，响应时间可接受 | P2 |

---

## 5. 边界与异常场景清单（聚焦 MVP）
- 价格为负、为 0 或缺失
- 方案包组件为空或数量为 0
- 兼容规则循环或优先级冲突
- 价格策略与活动价冲突
- 内容配置缺失导致前台渲染异常
- 发布前校验失败（内容与价格不一致）

---

## 6. Week 1-2 交付清单
- UI 测试计划与用例框架（含主流程与边界）
- API 测试计划与用例框架（含主流程与边界）
- 覆盖 `doc/plan.md` 的 MVP 业务流程与接口列表

---

## 7. W3 联调测试补充（可执行）

### 7.1 已联调接口与基础数据
- API Base: `http://localhost:8080`
- 方案包列表：`GET /api/packages`
- 方案包详情：`GET /api/packages/{id}`
- 价格计算：`POST /api/pricing/calc`
- 规则校验：`POST /api/rules/validate`
- 提交询价：`POST /api/inquiries`

基础数据：
- 方案包：ID 1/2
- SKU：101/102/103

### 7.2 关键请求样例（用于联调）

`POST /api/pricing/calc`
```json
{
  "packageId": 1,
  "items": [
    {"skuId": 101, "quantity": 1},
    {"skuId": 102, "quantity": 2}
  ],
  "regionCode": "east"
}
```

`POST /api/rules/validate`
```json
{
  "items": [
    {"skuId": 101, "quantity": 1},
    {"skuId": 102, "quantity": 4}
  ],
  "scene": "冷库",
  "area": 18
}
```

`POST /api/inquiries`
```json
{
  "customerName": "张三",
  "phone": "13800000000",
  "projectAddress": "上海市浦东新区",
  "area": 60,
  "scene": "冷库",
  "packageId": 1,
  "selectedConfigJson": "[{\"skuId\":101,\"quantity\":1}]",
  "calcPriceCents": 2648000
}
```

### 7.3 联调执行步骤
1. 启动后端：`mvn -f backend/pom.xml spring-boot:run`
2. 启动前端：`npm --workspace frontend run dev`
3. 打开前端首页，确认方案包列表加载
4. 套用方案包 → 价格更新 → 规则提示
5. 调整数量 → 价格联动与规则提示更新
6. 提交询价 → 返回成功文案

### 7.4 结果记录
- 通过/失败 + 失败截图
- 记录接口返回内容与 UI 展示是否一致
